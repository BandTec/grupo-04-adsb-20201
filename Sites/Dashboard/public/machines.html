<!DOCTYPE html>
<html lang="pr-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Maquinas - MIND 6</title>
    <link rel="stylesheet" href="css/menu.css">
    <link rel="stylesheet" href="css/machines.css">
</head>

<body>
    <header class="menu" id="menuBar" style="left: 0px;">

    </header>
    <div class="page machines">
        <button onclick=" Menu()" class="menu__btn"><i class="fas fa-bars menu__btn-open"></i></button>
        <i class="fas fa-arrow-left dashboard__return-btn" onclick="window.history.back()"></i>
        <h3 class="machines__title">Computadores</h3>
        <div class="machines__box-machines" id="machines">
            <!-- COMPUTADORES SERÃO ADICIONADOS AQUI -->
        </div>
        <button class="machine__btn-dash" onclick="window.location = 'dashboards.html'" id="btnDash">Visualizar
            Dashbords</button>

        <div class="machines__reports">
            <h3  class="machines__reports__title">Relatorios recentes</h3>
            <div class="machines__reports__selectors">
                <input type="date" class="machines__reports__selectors__selector">
            </div>
            <div class="machines__reports__box-reports">
                <table class="machines__reports__box-reports__table-reports">
                    <thead class="machines__reports__box-reports__table-reports__table-title">
                        <th>Relatório</th>
                        <th>Título</th>
                        <th>Data</th>
                    </thead>
                    <tbody id="reports">
                        <!-- RELATORIOS SERÃO INSERIDOS AQUI -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    <form id="form_fk" style="display: none;">
        <input type="text" id="fk" name="fkEscola">
    </form>
</body>

</html>

<script src="https://kit.fontawesome.com/26d639ee5e.js" crossorigin="anonymous"></script>
<script src="./js/menu.js"></script>
<script>
    let idMachineSelected;
    let idMachines;

    function addMachines() {
        fk.value = sessionStorage.fkEscola;
        var formulario = new URLSearchParams(new FormData(form_fk));
        fetch("/computador/recuperar", {
            method: "POST",
            body: formulario
        }).then(response => {

            if (response.ok) {

                response.json().then(json => {
                    for (let i = 0; i < json.length; i++) {
                        machines.innerHTML += `<div onclick="enableButton()" class="machines__box-machines__machine">
                                <h4 class="machines__box-machines__machine__name">
                                    ${json[i].nomeComputador}
                                </h4>
                                <i onclick="selectMachine(${"machine" + i}, ${json.length})" id="machine${i}" data-fkComputer="${json[i].idComputador}" class="fas fa-desktop machines__box-machines__machine__icon "></i>
                            </div>`;
                    }
                });

            } else {

                console.log('Erro de login!');

                response.text().then(texto => {
                    console.error(texto);
                });
            }
        });

    }

    function selectMachine(n, max) {

        for (let i = 0; i < max; i++) {
            idMachines = "machine" + i;
            document.getElementById(idMachines).style.color = "black";
        }
        n.style.color = "blue";
        idMachineSelected = n.dataset.fkcomputer;
        sessionStorage.fkcomputer = idMachineSelected;
    }



    const descriptions = [
        "CPU alta temperatura",
        "Alto consumo de CPU por mais de 1 hora",
        "Alto consumo de Memória por mais de 1 hora",
        "Alto consumo de Disco por mais de 2 hora"
    ]
    function addReports() {
        for (i = 0; i < 50; i++) {
            reports.innerHTML += `<tr class="machines__reports__box-reports__report">
                                    <td>Relatório de máquina PC${Math.floor(Math.random() * 51 + 1)}-SALA1A</td>
                                    <td>${descriptions[Math.floor(Math.random() * 4)]}</td>
                                    <td>${(Math.floor(Math.random() * 32 + 1)) + "/" + Math.floor((Math.random() * 13 + 1)) + "/" + 2020}</td>
                                </tr>`;
        }
    }
    addMachines();
    addReports();

    function enableButton() {
        btnDash.style.display = "block";
    }
</script>